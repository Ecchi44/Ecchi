<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="./css/list.css" type="text/css">
    <link rel="stylesheet" href="./libs/public.css" type="text/css">
</head>
<body>
<div id="header" class="margin clear">
    <div class="top margin clear">
        <div class="logreg">
            <a href="./log.html">登录</a>
            <a href="./reg.html">注册</a>
        </div>
        <div class="welcome">
            <h2>会员<span class="user_n"></span>您好！<em class="tc_dl">退出登录</em></h2>
        </div>
    </div>
    <div class="logo margin clear">
        <div class="logo_pic">
            <a href="#"><img src="images/logo.jpg" alt=""></a>
        </div>
        <div class="form">
            <div class="search">
                <input type="text" class="txt">
                <input type="button" value="搜索" class="btn">
            </div>
            <div class="hot_search">
                <ul>
                    <li class="first">热门搜索：</li>
                    <li><a href="#">手机</a></li>
                    <li><a href="#">手机</a></li>
                    <li><a href="#">手机</a></li>
                    <li><a href="#">手机</a></li>
                    <li><a href="#">手机</a></li>
                    <li><a href="#">手机</a></li>
                    <li><a href="#">手机</a></li>
                    <li><a href="#">手机</a></li>
                    <li><a href="#">手机</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="nav margin">
        <div class="category"><div><h2>全部商品分类</h2></div></div>
        <div class="nav_nav">
            <ul>
                <li><a href="#">首页</a></li>
                <li><a href="#">商品列表</a></li>
                <li><a href="#">商品列表</a></li>
                <li><a href="#">商品列表</a></li>
                <li><a href="#">商品列表</a></li>
            </ul>
        </div>
        <div class="utility">
            <!--            <dl class="car">-->
            <!--                <dt><a href="./car.html"><span>0</span>件</a></dt>-->
            <!--                <dd>-->
            <!--                    <div class="car_head"></div>-->
            <!--                    <div class="car_td">-->
            <!--                        <div class="car_td1">-->
            <!--&lt;!&ndash;                            <a href="#" class="a_btn btn_top"></a>&ndash;&gt;-->
            <!--                            <div class="car_list">-->
            <!--                                <ul>-->
            <!--                                    <li>-->
            <!--                                        <img src="" alt="">-->
            <!--                                        <p class="p_name">-->
            <!--                                            <a href="#"></a>-->
            <!--                                        </p>-->
            <!--                                        <div class="p_price">-->
            <!--                                            <p>-->
            <!--                                                <span>-->
            <!--                                                    <em>￥</em>-->
            <!--                                                    4444-->
            <!--                                                </span>-->
            <!--                                                x1-->
            <!--                                            </p>-->
            <!--                                            <a href="#">删除</a>-->
            <!--                                        </div>-->
            <!--                                    </li>-->
            <!--                                    <li>-->
            <!--                                        <img src="" alt="">-->
            <!--                                        <p class="p_name">-->
            <!--                                            <a href="#"></a>-->
            <!--                                        </p>-->
            <!--                                        <div class="p_price">-->
            <!--                                            <p>-->
            <!--                                                <span>-->
            <!--                                                    <em>￥</em>-->
            <!--                                                    4444-->
            <!--                                                </span>-->
            <!--                                                x1-->
            <!--                                            </p>-->
            <!--                                            <a href="#">删除</a>-->
            <!--                                        </div>-->
            <!--                                    </li>-->
            <!--                                    <li>-->
            <!--                                        <img src="" alt="">-->
            <!--                                        <p class="p_name">-->
            <!--                                            <a href="#"></a>-->
            <!--                                        </p>-->
            <!--                                        <div class="p_price">-->
            <!--                                            <p>-->
            <!--                                                <span>-->
            <!--                                                    <em>￥</em>-->
            <!--                                                    4444-->
            <!--                                                </span>-->
            <!--                                                x1-->
            <!--                                            </p>-->
            <!--                                            <a href="#">删除</a>-->
            <!--                                        </div>-->
            <!--                                    </li>-->
            <!--                                    <li>-->
            <!--                                        <img src="" alt="">-->
            <!--                                        <p class="p_name">-->
            <!--                                            <a href="#"></a>-->
            <!--                                        </p>-->
            <!--                                        <div class="p_price">-->
            <!--                                            <p>-->
            <!--                                                <span>-->
            <!--                                                    <em>￥</em>-->
            <!--                                                    4444-->
            <!--                                                </span>-->
            <!--                                                x1-->
            <!--                                            </p>-->
            <!--                                            <a href="#">删除</a>-->
            <!--                                        </div>-->
            <!--                                    </li>-->
            <!--                                    <li>-->
            <!--                                        <img src="" alt="">-->
            <!--                                        <p class="p_name">-->
            <!--                                            <a href="#"></a>-->
            <!--                                        </p>-->
            <!--                                        <div class="p_price">-->
            <!--                                            <p>-->
            <!--                                                <span>-->
            <!--                                                    <em>￥</em>-->
            <!--                                                    4444-->
            <!--                                                </span>-->
            <!--                                                x1-->
            <!--                                            </p>-->
            <!--                                            <a href="#">删除</a>-->
            <!--                                        </div>-->
            <!--                                    </li>-->
            <!--                                    <li>-->
            <!--                                        <img src="" alt="">-->
            <!--                                        <p class="p_name">-->
            <!--                                            <a href="#"></a>-->
            <!--                                        </p>-->
            <!--                                        <div class="p_price">-->
            <!--                                            <p>-->
            <!--                                                <span>-->
            <!--                                                    <em>￥</em>-->
            <!--                                                    4444-->
            <!--                                                </span>-->
            <!--                                                x1-->
            <!--                                            </p>-->
            <!--                                            <a href="#">删除</a>-->
            <!--                                        </div>-->
            <!--                                    </li>-->
            <!--                                    <li>-->
            <!--                                        <img src="" alt="">-->
            <!--                                        <p class="p_name">-->
            <!--                                            <a href="#"></a>-->
            <!--                                        </p>-->
            <!--                                        <div class="p_price">-->
            <!--                                            <p>-->
            <!--                                                <span>-->
            <!--                                                    <em>￥</em>-->
            <!--                                                    4444-->
            <!--                                                </span>-->
            <!--                                                x1-->
            <!--                                            </p>-->
            <!--                                            <a href="#">删除</a>-->
            <!--                                        </div>-->
            <!--                                    </li>-->
            <!--                                    <li>-->
            <!--                                        <img src="" alt="">-->
            <!--                                        <p class="p_name">-->
            <!--                                            <a href="#"></a>-->
            <!--                                        </p>-->
            <!--                                        <div class="p_price">-->
            <!--                                            <p>-->
            <!--                                                <span>-->
            <!--                                                    <em>￥</em>-->
            <!--                                                    4444-->
            <!--                                                </span>-->
            <!--                                                x1-->
            <!--                                            </p>-->
            <!--                                            <a href="#">删除</a>-->
            <!--                                        </div>-->
            <!--                                    </li>-->
            <!--                                </ul>-->
            <!--                            </div>-->
            <!--&lt;!&ndash;                            <a href="#" class="a_btn btn_bottom"></a>&ndash;&gt;-->
            <!--                            <div class="cart">-->
            <!--                                <div class="miniCar clear">-->
            <!--                                    购物车中共<em>1</em>件商品&nbsp;&nbsp;&nbsp;&nbsp;共计<strong>￥4444</strong>元-->
            <!--                                </div>-->
            <!--                                <div class="buy">-->
            <!--                                <label>-->
            <!--                                    <input type="button" value="去购物车结算">-->
            <!--                                </label>-->
            <!--                            </div>-->
            <!--                            </div>-->
            <!--                        </div>-->
            <!--                        <div class="car_td2">-->
            <!--                            <div class="car_td3">-->
            <!--                                <span class="icon_urge"></span>-->
            <!--                                您还没有购买商品，快去挑选吧！-->
            <!--                            </div>-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </dd>-->
            <!--            </dl>-->
            <h3><a href="./car.html">去结算</a></h3>
        </div>
    </div>

    <div class="go_top">
        <a href="#"></a>
        <a href="#"></a>
    </div>
</div>
<div class="nav_tip_list margin clear"><span>您当前的位置：</span>
    <a href="./index.html">首页</a>&nbsp&gt;<a href="#">商品列表</a></div>
<div class="main margin clear">
    <ul class="list">
<!--        <li>-->
<!--            <a href="" class="show">-->
<!--                <img src="./data/img/1.jpg" alt="">-->
<!--                <p>红色小象婴儿多效洗衣液(1.2L+500ML*2)儿童洗衣套装 家庭衣物柔顺天然洗衣皂液</p>-->
<!--                <span>￥44.00</span>-->
<!--            </a>-->
<!--            <a href="#" class="addCar">购买</a>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a href="" class="show">-->
<!--                <img src="./data/img/1.jpg" alt="">-->
<!--                <p>红色小象婴儿多效洗衣液(1.2L+500ML*2)儿童洗衣套装 家庭衣物柔顺天然洗衣皂液</p>-->
<!--                <span>￥44.00</span>-->
<!--            </a>-->
<!--            <a href="#" class="addCar">购买</a>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a href="" class="show">-->
<!--                <img src="./data/img/1.jpg" alt="">-->
<!--                <p>红色小象婴儿多效洗衣液(1.2L+500ML*2)儿童洗衣套装 家庭衣物柔顺天然洗衣皂液</p>-->
<!--                <span>￥44.00</span>-->
<!--            </a>-->
<!--            <a href="#" class="addCar">购买</a>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a href="" class="show">-->
<!--                <img src="./data/img/1.jpg" alt="">-->
<!--                <p>红色小象婴儿多效洗衣液(1.2L+500ML*2)儿童洗衣套装 家庭衣物柔顺天然洗衣皂液</p>-->
<!--                <span>￥44.00</span>-->
<!--            </a>-->
<!--            <a href="#" class="addCar">购买</a>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a href="" class="show">-->
<!--                <img src="./data/img/1.jpg" alt="">-->
<!--                <p>红色小象婴儿多效洗衣液(1.2L+500ML*2)儿童洗衣套装 家庭衣物柔顺天然洗衣皂液</p>-->
<!--                <span>￥44.00</span>-->
<!--            </a>-->
<!--            <a href="#" class="addCar">购买</a>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a href="" class="show">-->
<!--                <img src="./data/img/1.jpg" alt="">-->
<!--                <p>红色小象婴儿多效洗衣液(1.2L+500ML*2)儿童洗衣套装 家庭衣物柔顺天然洗衣皂液</p>-->
<!--                <span>￥44.00</span>-->
<!--            </a>-->
<!--            <a href="#" class="addCar">购买</a>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a href="" class="show">-->
<!--                <img src="./data/img/1.jpg" alt="">-->
<!--                <p>红色小象婴儿多效洗衣液(1.2L+500ML*2)儿童洗衣套装 家庭衣物柔顺天然洗衣皂液</p>-->
<!--                <span>￥44.00</span>-->
<!--            </a>-->
<!--            <a href="#" class="addCar">购买</a>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a href="" class="show">-->
<!--                <img src="./data/img/1.jpg" alt="">-->
<!--                <p>红色小象婴儿多效洗衣液(1.2L+500ML*2)儿童洗衣套装 家庭衣物柔顺天然洗衣皂液</p>-->
<!--                <span>￥44.00</span>-->
<!--            </a>-->
<!--            <a href="#" class="addCar">购买</a>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a href="" class="show">-->
<!--                <img src="./data/img/1.jpg" alt="">-->
<!--                <p>红色小象婴儿多效洗衣液(1.2L+500ML*2)儿童洗衣套装 家庭衣物柔顺天然洗衣皂液</p>-->
<!--                <span>￥44.00</span>-->
<!--            </a>-->
<!--            <a href="#" class="addCar">购买</a>-->
<!--        </li>-->
<!--        <li>-->
<!--            <a href="" class="show">-->
<!--                <img src="./data/img/1.jpg" alt="">-->
<!--                <p>红色小象婴儿多效洗衣液(1.2L+500ML*2)儿童洗衣套装 家庭衣物柔顺天然洗衣皂液</p>-->
<!--                <span>￥44.00</span>-->
<!--            </a>-->
<!--            <a href="#" class="addCar">购买</a>-->
<!--        </li>-->
    </ul>
</div>
<div class="page-list">
    <a href="#" class="pgLeft">上一页</a>
    <div class="lists"></div>
    <a href="#" class="pgRight">下一页</a>
</div>
</body>
<script src="./js/ajax.js"></script>
<script src="./js/cookie.js"></script>
<script>
    class List{
        constructor(){
            this.url = "./data/goods.json";
            this.list = document.querySelector(".list");
            this.page= document.querySelector(".lists");
            this.pgLeft = document.querySelector(".pgLeft");
            this.pgRight= document.querySelector(".pgRight");
            this.txt = document.querySelector(".search .txt");
            this.index = 0;
            let val = location.search;
            this.reg=/\?name=(.*)/;
            this.sear=this.reg.exec(val)?decodeURIComponent(this.reg.exec(val)[1]):"";
            this.txt.value=this.sear;
            this.search();
            this.init();
        }
        search(){
            if(this.sear===""){
                location.href = "./index.html";
            }
        }
        init(){
            ajaxGet(this.url,(res)=>{
                this.res=JSON.parse(res);
                for(var i=0;i<this.res.length;i++){
                    if(!this.res[i].name.includes(this.sear)){
                        this.res.splice(i,1);
                        i--;
                    }
                }
                this.displayO();
                this.displayT();
                this.addEvent();
            })
        }
        displayO(){
            let str = "";
            if(this.res.length<=0){
                str=`<h2 class="empty">没有搜索到符合的商品</h2>`;
            }else {
                for (var i = this.index * 5; i < (this.index + 1) * 5; i++) {
                    if (i >= this.res.length) break;
                    str += `<li index="${this.res[i].img}">
            <a href="./part.html?id=${this.res[i].img}" class="show">
                <img src="${this.res[i].img}" alt="">
                <p>${this.res[i].name}</p>
                <span>¥${this.res[i].price}</span>
            </a>
            <a href="#" class="addCar">添加到购物车</a>
        </li>`
                }
            }
            this.list.innerHTML=str;
        }
        displayT(){
            this.max=Math.ceil(this.res.length/5);
            let str="";
            for(var i=0;i<this.max;i++){
                str+=`<a href="#">${i+1}</a>`
            }
            this.page.innerHTML=str;
            this.listA=this.page.children;
            for(let i=0;i<this.listA.length;i++){
                this.listA[i].onclick=()=> {
                    this.index=i;
                    console.log(this.index);
                    this.displayO();
                    return false;
                }
            }
        }
        addEvent(){
            this.pgLeft.onclick=()=>{
                if(this.index===0){
                    this.index=0
                }else{
                    this.index--;
                }
                this.displayO();
                return false;
            };
            this.pgRight.onclick=()=>{
                if(this.index===this.max-1){
                    this.index=this.max-1
                }else{
                    this.index++;
                }
                this.displayO();
                return false;
            };
            let that = this;
            this.list.addEventListener("click",function(eve){
                let e = eve || window.event;
                let target = e.target || e.srcElement;
                if(target.className === "addCar"){
                    that.id = target.parentNode.getAttribute("index");
                    that.setCookie();
                }
            })
        }
        setCookie(){
            this.goods = getCookie("goodsCookie") ? JSON.parse(getCookie("goodsCookie")) : [];
            if(this.goods.length < 1){
                this.goods.push({
                    id:this.id,
                    num:1
                })
            }else{
                var i = 0;
                var onoff = this.goods.some((val,idx)=>{
                    i = idx;
                    return val.id === this.id;
                });
                if(!onoff){
                    this.goods.push({
                        id:this.id,
                        num:1
                    })
                }else{
                    this.goods[i].num++;
                }
            }
            setCookie("goodsCookie",JSON.stringify(this.goods))
        }
    }
    new List;
</script>
</html>